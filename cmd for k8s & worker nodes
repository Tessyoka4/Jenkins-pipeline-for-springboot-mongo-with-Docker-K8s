sudo apt-get update -y  
sudo apt-get install -y apt-transport-https  
sudo su -  

curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -

cat <<EOF >/etc/apt/sources.list.d/kubernetes.list  
deb https://apt.kubernetes.io/ kubernetes-xenial main  
EOF  

# Note: when you paste the above line wait a while before hitting the enter key 
apt-get update -y  

# Disable swap memory
swapoff -a  
sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab 

# Enable IP memories:
modprobe br_netfilter
sysctl -p  
sudo sysctl net.bridge.bridge-nf-call-iptables=1  

# Add ubuntu user to the docker group
apt install docker.io -y

# This is optional
usermod -aG docker ubuntu  

systemctl restart docker
systemctl enable docker.service  

# Install k8s modules:
apt-get install -y kubelet kubeadm kubectl kubernetes-cni  

systemctl daemon-reload
systemctl start kubelet   
systemctl enable kubelet.service  

# Execute below commands only in master node as root user.  
kubeadm init  
# Exit root user (exit) & execute as normal user  
mkdir -p $HOME/.kube  
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config  
sudo chown $(id -u):$(id -g) $HOME/.kube/config  

kubectl get nodes
kubectl get pods --all-namespaces

kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version |  base64 | tr -d '\n')"  

kubectl get nodes  
kubectl get pods --all-namespaces 
  
# on worker nodes, exit as root user and run commands to join worker node to master node.
kubectl get nodes  
kubectl get pods --all-namespaces 
